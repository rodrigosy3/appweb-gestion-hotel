<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <!-- Cambia 'static' a '/css/' para Thymeleaf -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/bootstrap-icons/font/bootstrap-icons.css}">
</head>

<body>
    <div th:insert="~{fragments/navbar :: navbar}"></div>

    <!-- Modal de Advertencia -->
    <div class="modal fade bg-danger bg-opacity-50" id="modalVetado" tabindex="-1" aria-labelledby="modalVetadoLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border border-danger shadow-lg">
                <div class="modal-header bg-danger text-white justify-content-center">
                    <h5 class="modal-title fw-bold">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i> USUARIO BLOQUEADO - VETADO
                    </h5>
                </div>
                <div class="modal-body bg-light border border-light px-2 m-2 text-center">
                    <span class="fw-bold text-danger fs-5 mb-2">El usuario ha sido bloqueado por la razón:</span>
                    <!-- Aquí se mostrará la razón del veto -->
                    <p id="razonVeto" class="fw-semibold text-dark m-2"></p>
                </div>
                <div class="modal-footer bg-danger justify-content-center">
                    <button type="button" class="btn btn-light fw-bold px-4" data-bs-dismiss="modal">CERRAR</button>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show text-center me-5" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div th:if="${mensaje}" class="alert alert-danger alert-dismissible fade show text-center me-5" role="alert">
        <span th:text="${mensaje}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="card mx-auto shadow mb-5" style="width: 75%;">
        <div class="card-header text-bg-dark" style="font-size: x-large;">
            <div class="d-flex justify-content-between">
                <div class="fw-bold" th:text="${'Habitación: ' + habitacion.numero}"></div>
                <div class="fw-bold" th:text="${habitacion.tipo.nombre_tipo}"></div>
                <div class="fw-bold" th:text="${'S/. ' + #numbers.formatDecimal(habitacion.precio, 1, 2)}"
                    id="habitacionPrecio" th:data-precio="${habitacion.precio}">PRECIO</div>
            </div>
        </div>

        <div class="card-body">
            <!-- Botones para cambiar contenido -->
            <ul class="nav nav-pills justify-content-between border border-primary rounded mb-4">
                <li class="nav-item">
                    <button class="nav-link fw-bold active" data-bs-toggle="tab" data-bs-target="#venta-tab">SERVICIO DE
                        ALOJAMIENTO</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link fw-bold" data-bs-toggle="tab" data-bs-target="#reserva-tab">RESERVAR
                        HABITACIÓN</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link fw-bold" data-bs-toggle="tab" data-bs-target="#estado-tab">ESTADO DE LA
                        HABITACIÓN</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link fw-bold" data-bs-toggle="tab" data-bs-target="#detalles-tab">CONTENIDO DE
                        LA HABITACIÓN</button>
                </li>
            </ul>

            <!-- Contenido de cada sección -->
            <div class="tab-content mt-3 mx-3">

                <!-- Sección de Clientes -->
                <div th:switch="${habitacion.estado.estado}" class="tab-pane fade show active" id="venta-tab">
                    <!-- Caso: LIMPIEZA -->
                    <div th:case="'LIMPIEZA'">
                        <div class="alert alert-info text-center">
                            <h4 class="fs-2 text-uppercase">Habitación en Limpieza</h4>
                            <p class="fs-4 mt-4">Una vez terminada la limpieza, presiona el botón azul "LIMPIEZA
                                TERMINADA"</p>

                            <form th:action="@{/actualizar-estado-habitacion}" method="post">
                                <input type="hidden" name="id" th:value="${habitacion.id_habitacion}">
                                <input type="hidden" name="nuevoEstado" value="DISPONIBLE">
                                <input type="hidden" name="msgEstado" value="Habitación disponible para venta">

                                <div class="col text-center mt-5 mb-3">
                                    <button type="submit" class="btn btn-primary w-25 me-3"
                                        id="btnLimpiezaTerminada">LIMPIEZA
                                        TERMINADA</button>
                                    <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Caso: MANTENIMIENTO -->
                    <div th:case="'MANTENIMIENTO'">
                        <div class="alert alert-warning text-center" id="mantenimientoDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación en Mantenimiento</h4>
                            <p class="fs-4 mt-4">Esta habitación no está disponible para ventas. <br>
                                Presiona "VER DETALLES" para cambiar el estado actual de la habitacion.
                            </p>

                            <div class="col text-center mt-5 mb-3">
                                <button type="button" class="btn btn-primary w-25 me-3"
                                    id="btnVerDetallesMantenimiento">VER
                                    DETALLES</button>
                                <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">VOLVER</button>
                            </div>
                        </div>
                    </div>

                    <!-- Caso: NO DISPONIBLE -->
                    <div th:case="'NO DISPONIBLE'">
                        <div class="alert alert-dark text-center" id="noDisponibleDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación No Disponible</h4>
                            <p class="fs-4 mt-4">Actualmente esta habitación está fuera de servicio. <br>
                                Presiona "VER DETALLES" para cambiar el estado actual de la habitacion.
                            </p>

                            <div class="col text-center mt-5 mb-3">
                                <button type="button" class="btn btn-primary w-25 me-3"
                                    id="btnVerDetallesNoDisponible">VER
                                    DETALLES</button>
                                <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">VOLVER</button>
                            </div>
                        </div>
                    </div>

                    <!-- Caso: RESERVA -->
                    <div th:case="'RESERVADA'">
                        <div class="alert alert-success text-center" id="reservadaDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación Reservada</h4>
                            <p class="fs-4 mt-5">
                                Presiona "VER DETALLES" para editar la Reserva. <br>
                                Presiona "OCUPAR HABITACIÓN" para finalizar la reserva y generar la
                                venta.
                            </p>

                            <form th:action="@{/actualizar-estado-habitacion}" method="post">
                                <input type="hidden" name="id" th:value="${habitacion.id_habitacion}">
                                <input type="hidden" name="nuevoEstado" value="OCUPADO">
                                <input type="hidden" name="msgEstado" value="Habitación ocupada por el cliente">
                                <input type="hidden" name="id_ventaHabitacion" th:value="${ventaParaReserva.id_venta}">

                                <div class="col text-center mt-5 mb-3">
                                    <button type="button" class="btn btn-primary w-25" id="btnVerDetallesReserva">VER
                                        DETALLES
                                    </button>
                                    <button type="submit" class="btn btn-success w-25 mx-3"
                                        id="reservabtnHabilitarReserva">OCUPAR HABITACIÓN</button>
                                    <button type="button" class="btn btn-danger w-25" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div th:case="*" class="tab-pane fade show active" id="venta-tab">
                        <form th:action="@{/{idHabitacion}(idHabitacion=${habitacion.id_habitacion})}"
                            th:object="${ventaHabitacion}" id="formVentaHabitacion" method="post">
                            <div class="row row-cols-2 justify-content-between w-100">
                                <div class="col">
                                    <table class="table table-sm table-hover border shadow" id="tablaClientes">
                                        <thead class="table-secondary border-light">
                                            <tr>
                                                <th>D.N.I.</th>
                                                <th>Nombres</th>
                                                <th>Apellidos</th>
                                                <th>Edad</th>
                                                <th colspan="2">Celular</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tablaClientesBody">
                                            <tr th:each="cliente : ${ventaHabitacion?.ventasClientesHabitacion}">
                                                <td class="border align-middle"><span
                                                        th:text="${cliente.usuario_alojado.dni}"></span></td>
                                                <td class="align-middle"><span
                                                        th:text="${cliente.usuario_alojado.nombres}"></span>
                                                </td>
                                                <td class="align-middle"><span
                                                        th:text="${cliente.usuario_alojado.apellidos}"></span></td>
                                                <td class="align-middle"><span
                                                        th:text="${cliente.usuario_alojado.edad}"></span></td>
                                                <td class="align-middle"><span
                                                        th:text="${cliente.usuario_alojado.celular}"></span></td>
                                                <td class="text-center align-middle border">
                                                    <button type="button" class="btn btn-danger btn-sm"
                                                        th:attr="onclick='eliminarCliente(this, ' + ${cliente.usuario_alojado.dni} + ')'">X</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="col-5 ms-5">
                                    <div class="row row-cols-3 mb-2">
                                        <div
                                            class="col-2 w-25 align-content-center bg-primary-subtle fw-bold rounded-2">
                                            <label class="col-form-label">D.N.I. <span>:</span></label>
                                        </div>
                                        <div class="col-8 w-50">
                                            <input type="text" id="inputDNI" class="form-control" maxlength="8">
                                        </div>
                                        <div class="col-auto w-25 p-0">
                                            <button type="button" class="btn btn-secondary h-100 w-100"
                                                id="btnBuscarDNI">
                                                BUSCAR
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row row-cols-2 mb-2">
                                        <div
                                            class="col-2 w-25 align-content-center bg-primary-subtle fw-bold rounded-2">
                                            <label class="col-form-label">NOMBRES <span>:</span></label>
                                        </div>
                                        <div class="col-9 w-75 pe-0">
                                            <input type="text" id="inputNombres" class="form-control text-uppercase">
                                        </div>
                                    </div>
                                    <div class="row row-cols-2 mb-2">
                                        <div
                                            class="col-2 w-25 align-content-center bg-primary-subtle fw-bold rounded-2">
                                            <label class="col-form-label">APELLIDOS <span>:</span></label>
                                        </div>
                                        <div class="col-9 w-75 pe-0">
                                            <input type="text" id="inputApellidos" class="form-control text-uppercase">
                                        </div>
                                    </div>
                                    <div class="row row-cols-2 mb-2">
                                        <div class="col col-6">
                                            <div class="row">
                                                <div
                                                    class="w-50 align-content-center bg-primary-subtle fw-bold rounded-2">
                                                    <label class="col-form-label">CELULAR <span>:</span></label>
                                                </div>
                                                <div class="w-50 pe-0">
                                                    <input type="text" id="inputCelular" maxlength="9" minlength="9"
                                                        min="900000000" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col col-6 ps-4">
                                            <div class="row">
                                                <div
                                                    class="w-50 align-content-center bg-primary-subtle fw-bold rounded-2">
                                                    <label class="col-form-label">EDAD <span>:</span></label>
                                                </div>
                                                <div class="w-50 pe-0">
                                                    <input type="number" id="inputEdad" maxlength="3" minlength="1"
                                                        min="0" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto w-100 mt-2 text-center">
                                            <button type="button" class="btn btn-success w-50 text-uppercase border"
                                                id="btnAgregarCliente">Agregar
                                                Cliente</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="border border-black my-4">

                            <div class="row row-cols-2 justify-content-between w-100">
                                <div class="col" style="height: min-content;">
                                    <div class="row">
                                        <div class="row row-cols-1">
                                            <table class="table table-hover shadow w-auto">
                                                <thead class="table-secondary border-light">
                                                    <tr>
                                                        <th><label class="form-label">Contenido</label></th>
                                                        <th><label class="form-label">Valor</label></th>
                                                        <th><label class="form-label">Estado</label></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="contenido : ${habitacion.HabitacionesContenido}">
                                                        <td><span th:text="${contenido.caracteristica.nombre}"></span>
                                                        </td>
                                                        <td><span th:text="${contenido.caracteristica.precio}"></span>
                                                        </td>
                                                        <td><span th:text="${contenido.estado_caracteristica}"></span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="row mt-3">
                                            <div class="col col-auto p-0">
                                                <table class="table table-hover shadow border border-light">
                                                    <thead class="table-secondary mb-2">
                                                        <tr>
                                                            <th class="text-center">DÍA/HORA ENTRADA</th>
                                                            <th class="text-center">SERVICIO</th>
                                                            <th class="text-center">DÍA/HORA SALIDA</th>
                                                            <th class="text-center">PRECIO</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="tableBodyFechasAlojamiento">
                                                        <tr>
                                                            <td><input type="text" id="fechaHoraEntrada"
                                                                    class="form-control">
                                                            </td>
                                                            <td>
                                                            </td>
                                                            <td><input type="text" id="fechaHoraSalida"
                                                                    class="form-control">
                                                            </td>
                                                            <td><input type="text" id="precioHabitacion"
                                                                    class="form-control"></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col mb-3">
                                    <div class="row m-2 shadow rounded-4 align-items-center justify-content-center">
                                        <div class="row mb-3 bg-primary text-light fs-5 fw-bold align-content-center justify-content-center rounded-top-4"
                                            style="height: 2.2rem;">RESUMEN DE LA VENTA</div>

                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                DÍAS DE ALOJAMIENTO:
                                            </div>
                                            <div class="col">
                                                <input type="number" class="text-center form-control"
                                                    th:field="*{tiempo_estadia}" id="diasAlojamientoResumen" min="1">
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                TIPO
                                                DE SERVICIO (Último día):</div>
                                            <div class="col">
                                                <select class="form-select text-center" th:field="*{tipo_servicio}"
                                                    id="selectTipoServicioResumen">
                                                    <option th:value="${'COMPLETO'}" data-tipo="COMPLETO">
                                                        COMPLETO
                                                        (12:00 pm)</option>
                                                    <option th:value="${'MEDIO'}" data-tipo="MEDIO">MEDIO DÍA
                                                        (6:00 pm)
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                FECHA
                                                DE ENTRADA: </div>
                                            <div class="col">
                                                <input type="text" class="text-center form-control bg-secondary-subtle"
                                                    id="fechaEntradaResumen" readonly>
                                                <input type="hidden" th:field="*{fecha_entrada}"
                                                    id="fechaEntradaResumenValor">
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                FECHA
                                                DE SALIDA: </div>
                                            <div class="col">
                                                <input type="text" class="text-center form-control bg-secondary-subtle"
                                                    id="fechaSalidaResumen" readonly>
                                                <input type="hidden" th:field="*{fecha_salida}"
                                                    id="fechaSalidaResumenValor">
                                            </div>
                                        </div>

                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                DESCUENTO: </div>
                                            <div class="col">
                                                <input type="number" class="text-center form-control" placeholder="0.00"
                                                    th:field="*{descuento}" id="descuentoResumen" min="0" step="0.01"
                                                    readonly>
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                ADELANTO DEL TOTAL: </div>
                                            <div class="col">
                                                <input type="number" class="text-center form-control" placeholder="0.00"
                                                    th:field="*{monto_adelanto}" id="montoAdelantoResumen" min="0"
                                                    step="0.01">
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                TOTAL:
                                            </div>
                                            <div class="col">
                                                <input type="number"
                                                    class="text-center form-control bg-success-subtle fw-bold rounded-2"
                                                    th:field="*{monto_total}" id="montoTotalResumen" min="0" step="0.01"
                                                    readonly>
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                ESTADO
                                                DE LA VENTA:</div>
                                            <div class="col">
                                                <select class="form-select text-center" th:field="*{estado}"
                                                    id="selectEstadoResumen">
                                                    <option th:value="${'POR COBRAR'}" data-tipo="POR COBRAR">POR COBRAR
                                                    </option>
                                                    <option th:value="${'PAGADO'}" data-tipo="PAGADO"> PAGADO
                                                    </option>
                                                </select>
                                            </div>
                                        </div>

                                        <input type="hidden" th:field="*{estado_estadia}" id="estadoEstadia">
                                        <input type="hidden" th:field="*{tipo_venta}" id="tipoVenta"
                                            th:value="${'ALQUILER'}">
                                        <input type="hidden" th:field="*{id_venta}" id="idVenta">

                                        <div class="row mb-4">
                                            <div class="col text-center">
                                                <button type="button" class="btn btn-primary w-50"
                                                    id="btnGuardar"><span th:text="${idVenta == null ? 'GENERAR LA NUEVA VENTA' : 'GUARDAR VENTA EDITADA'}"></span></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div class="row my-3">
                            <div class="col text-center">
                                <button type="button" class="btn btn-success w-75 fw-bold" id="btnRetirarCliente"
                                    th:if="${ventaHabitacion.id_venta}">
                                    FINALIZAR VENTA
                                </button>
                            </div>
                            <div class="col col-3 text-end">
                                <button type="button" class="btn btn-danger fw-bold" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">CANCELAR Y VOLVER</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Reservas -->
                <div th:switch="${habitacion.estado.estado}" class="tab-pane fade" id="reserva-tab">
                    <!-- Caso: LIMPIEZA -->
                    <div th:case="'LIMPIEZA'">
                        <div class="alert alert-info text-center">
                            <h4 class="fs-2 text-uppercase">Habitación en Limpieza</h4>
                            <p class="fs-4 mt-4">Una vez terminada la limpieza, presiona el botón azul "LIMPIEZA
                                TERMINADA"</p>

                            <form th:action="@{/actualizar-estado-habitacion}" method="post">
                                <input type="hidden" name="id" th:value="${habitacion.id_habitacion}">
                                <input type="hidden" name="nuevoEstado" value="DISPONIBLE">
                                <input type="hidden" name="msgEstado" value="">

                                <div class="col text-center mt-5 mb-3">
                                    <button type="submit" class="btn btn-primary w-25 me-3"
                                        id="btnLimpiezaTerminada">LIMPIEZA
                                        TERMINADA</button>
                                    <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Caso: MANTENIMIENTO -->
                    <div th:case="'MANTENIMIENTO'">
                        <div class="alert alert-warning text-center" id="mantenimientoDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación en Mantenimiento</h4>
                            <p class="fs-4 mt-4">Esta habitación no está disponible para limpieza ni ventas. <br>
                                Presiona en el botón azul "VER DETALLES" para editar el estado actual de la habitacion.
                            </p>

                            <div class="col text-center mt-5 mb-3">
                                <button type="button" class="btn btn-primary w-25 me-3"
                                    id="btnVerDetallesMantenimiento">VER
                                    DETALLES</button>
                                <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">VOLVER</button>
                            </div>
                        </div>
                    </div>

                    <!-- Caso: NO DISPONIBLE -->
                    <div th:case="'NO DISPONIBLE'">
                        <div class="alert alert-dark text-center" id="noDisponibleDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación No Disponible</h4>
                            <p class="fs-4 mt-4">Actualmente esta habitación está fuera de servicio. <br>
                                Presiona en el botón azul "VER DETALLES" para editar el estado actual de la habitacion.
                            </p>

                            <div class="col text-center mt-5 mb-3">
                                <button type="button" class="btn btn-primary w-25 me-3"
                                    id="btnVerDetallesNoDisponible">VER
                                    DETALLES</button>
                                <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">VOLVER</button>
                            </div>
                        </div>
                    </div>

                    <div th:case="*" class="tab-pane fade show active" id="venta-tab">
                        <form th:action="@{/reservar-habitacion/{id}(id=${habitacion.id_habitacion})}"
                            th:object="${ventaParaReserva}" id="reservaformVentaHabitacion" method="post">
                            <div class="row row-cols-2 justify-content-between w-100">
                                <div class="col">
                                    <table class="table table-sm table-hover border shadow" id="reservatablaClientes">
                                        <thead class="table-secondary border-light">
                                            <tr>
                                                <th>D.N.I.</th>
                                                <th>Nombres</th>
                                                <th colspan="2">Apellidos</th>
                                            </tr>
                                        </thead>
                                        <tbody id="reservatablaClientesBody">
                                            <tr th:each="cliente : ${ventaParaReserva?.ventasClientesHabitacion}">
                                                <td class="border align-middle"><span
                                                        th:text="${cliente.usuario_alojado.dni}"></span></td>
                                                <td class="align-middle"><span
                                                        th:text="${cliente.usuario_alojado.nombres}"></span>
                                                </td>
                                                <td class="align-middle"><span
                                                        th:text="${cliente.usuario_alojado.apellidos}"></span></td>
                                                <td class="text-center align-middle border">
                                                    <button type="button" class="btn btn-danger btn-sm"
                                                        th:attr="onclick='eliminarCliente(this, ' + ${cliente.usuario_alojado.dni} + ')'">X</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="col-5 ms-5">
                                    <div class="row row-cols-3 mb-2">
                                        <div
                                            class="col-2 w-25 align-content-center bg-primary-subtle fw-bold rounded-2">
                                            <label class="col-form-label">D.N.I. <span class="end-0">:</span></label>
                                        </div>
                                        <div class="col-8 w-50">
                                            <input type="text" id="reservainputDNI" class="form-control" maxlength="8">
                                        </div>
                                        <div class="col-auto w-25 p-0">
                                            <button type="button" class="btn btn-secondary h-100 w-100"
                                                id="reservabtnBuscarDNI">
                                                BUSCAR
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row row-cols-2 mb-2">
                                        <div
                                            class="col-2 w-25 align-content-center bg-primary-subtle fw-bold rounded-2">
                                            <label class="col-form-label">NOMBRES <span class="end-0">:</span></label>
                                        </div>
                                        <div class="col-9 w-75 pe-0">
                                            <input type="text" id="reservainputNombres"
                                                class="form-control text-uppercase">
                                        </div>
                                    </div>
                                    <div class="row row-cols-2 mb-2">
                                        <div
                                            class="col-2 w-25 align-content-center bg-primary-subtle fw-bold rounded-2">
                                            <label class="col-form-label">APELLIDOS <span class="end-0">:</span></label>
                                        </div>
                                        <div class="col-9 w-75 pe-0">
                                            <input type="text" id="reservainputApellidos"
                                                class="form-control text-uppercase">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-auto w-100 mt-2 text-center">
                                            <button type="button" class="btn btn-success w-50 text-uppercase border"
                                                id="reservabtnAgregarCliente">Agregar
                                                Cliente</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="border border-black my-4">

                            <div class="row row-cols-2 justify-content-between w-100">
                                <div class="col" style="height: min-content;">
                                    <div class="row">
                                        <div class="row row-cols-1">
                                            <table class="table table-hover shadow w-auto">
                                                <thead class="table-secondary border-light">
                                                    <tr>
                                                        <th><label class="form-label">Contenido</label></th>
                                                        <th><label class="form-label">Valor</label></th>
                                                        <th><label class="form-label">Estado</label></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="contenido : ${habitacion.HabitacionesContenido}">
                                                        <td><span th:text="${contenido.caracteristica.nombre}"></span>
                                                        </td>
                                                        <td><span th:text="${contenido.caracteristica.precio}"></span>
                                                        </td>
                                                        <td><span th:text="${contenido.estado_caracteristica}"></span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="row mt-3">
                                            <div class="col col-auto p-0">
                                                <table class="table table-hover shadow border border-light">
                                                    <thead class="table-secondary mb-2">
                                                        <tr>
                                                            <th class="text-center">DÍA/HORA ENTRADA</th>
                                                            <th class="text-center">SERVICIO</th>
                                                            <th class="text-center">DÍA/HORA SALIDA</th>
                                                            <th class="text-center">PRECIO</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="reservatableBodyFechasAlojamiento">
                                                        <tr>
                                                            <td><input type="text" id="reservafechaHoraEntrada"
                                                                    class="form-control">
                                                            </td>
                                                            <td>
                                                            </td>
                                                            <td><input type="text" id="reservafechaHoraSalida"
                                                                    class="form-control">
                                                            </td>
                                                            <td><input type="text" id="reservaprecioHabitacion"
                                                                    class="form-control"></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col mb-3">
                                    <div class="row m-2 shadow rounded-4 align-items-center justify-content-center">
                                        <div class="row mb-3 bg-primary text-light fs-5 fw-bold align-content-center justify-content-center rounded-top-4"
                                            style="height: 2.2rem;">RESUMEN DE LA RESERVA</div>

                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                FECHA
                                                DE ENTRADA: </div>
                                            <div class="col">
                                                <input type="datetime-local" class="text-center form-control"
                                                    th:field="*{fecha_entrada}" id="reservafechaEntradaResumen">
                                            </div>
                                        </div>

                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                DÍAS
                                                DE ALOJAMIENTO: </div>
                                            <div class="col">
                                                <input type="number" class="text-center form-control"
                                                    th:field="*{tiempo_estadia}" id="reservatiempoEstadiaResumen"
                                                    min="1">
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                TIPO
                                                DE SERVICIO:</div>
                                            <div class="col">
                                                <select class="form-select text-center" th:field="*{tipo_servicio}"
                                                    id="reservaselectTipoServicioResumen">
                                                    <option th:value="${'COMPLETO'}" data-tipo="COMPLETO">
                                                        COMPLETO
                                                        (12:00 pm)</option>
                                                    <option th:value="${'MEDIO'}" data-tipo="MEDIO">MEDIO DÍA
                                                        (6:00 pm)
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                FECHA
                                                DE SALIDA: </div>
                                            <div class="col">
                                                <input type="text" class="text-center form-control bg-secondary-subtle"
                                                    th:field="*{fecha_salida}" id="reservafechaSalidaResumen" readonly>
                                            </div>
                                        </div>

                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                DESCUENTO: </div>
                                            <div class="col">
                                                <input type="number" class="text-center form-control" placeholder="0.00"
                                                    th:field="*{descuento}" id="reservadescuentoResumen" min="0"
                                                    step="0.01">
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-2">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                ADELANTO DEL TOTAL: </div>
                                            <div class="col">
                                                <input type="number" class="text-center form-control" placeholder="0.00"
                                                    th:field="*{monto_adelanto}" id="reservamontoAdelantoResumen"
                                                    min="0" step="0.01">
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                TOTAL:
                                            </div>
                                            <div class="col">
                                                <input type="number"
                                                    class="text-center form-control bg-success-subtle fw-bold rounded-2"
                                                    th:field="*{monto_total}" id="reservamontoTotalResumen" min="0"
                                                    step="0.01" readonly>
                                            </div>
                                        </div>
                                        <div class="row row-cols-2 mb-4">
                                            <div class="col align-content-center bg-primary-subtle fw-bold rounded-2">
                                                ESTADO
                                                DE LA VENTA:</div>
                                            <div class="col">
                                                <select class="form-select text-center" th:field="*{estado}"
                                                    id="reservaselectEstadoResumen">
                                                    <option th:value="${'PAGADO'}" data-tipo="PAGADO" selected> PAGADO
                                                    </option>
                                                    <option th:value="${'POR COBRAR'}" data-tipo="POR COBRAR">POR COBRAR
                                                    </option>
                                                </select>
                                            </div>
                                        </div>

                                        <input type="hidden" th:field="*{estado_estadia}" id="reservaestadoEstadia">
                                        <input type="hidden" th:field="*{tipo_venta}" id="reservatipoVenta"
                                            th:value="${RESERVA}">
                                        <input type="hidden" th:field="*{id_venta}" id="reservaidVenta">

                                        <div class="row mb-4">
                                            <div class="col text-center">
                                                <button type="button" class="btn btn-primary w-50"
                                                    id="reservabtnGuardar">GUARDAR
                                                    RESERVA</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div class="row alert alert-dark">
                            <div class="col text-start w-25">
                                <button th:if="${ventaParaReserva.id_venta != null}" type="button"
                                    class="btn btn-danger" id="reservabtnRetirarReserva">
                                    CANCELAR Y ELIMINAR RESERVA
                                </button>
                            </div>
                            <div class="col text-start w-25">
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">VOLVER AL INICIO</button>
                            </div>
                            <div class="col text-center w-50">
                                <button th:if="${ventaParaReserva.id_venta != null}" type="button"
                                    class="btn btn-success" id="reservabtnHabilitarReserva">
                                    OCUPAR HABITACION Y FINALIZAR RESERVA
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de estado de habitación -->
                <div th:switch="${habitacion.estado.estado}" class="tab-pane fade" id="estado-tab">
                    <div th:case="'MANTENIMIENTO'">
                        <div class="alert alert-warning">
                            <h4 class="fs-2 text-uppercase text-center mb-3">Habitación en Mantenimiento</h4>

                            <form th:action="@{/editar-estado/habitacion/{id}(id=${habitacion.id_habitacion})}"
                                th:object="${habitacion}" method="post" class="w-50 mx-auto">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Estado de la Habitación:</label>
                                    <select class="form-select" th:field="*{estado}" th>
                                        <option class="text-center" th:each="estado : ${habEstados}"
                                            th:if="${estado.estado != 'OCUPADO' && estado.estado != 'RESERVADA'}"
                                            th:value="${estado.id_habitacion_estado}" th:text="${estado.estado}">ESTADO
                                        </option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label fw-bold">Razón:</label>
                                    <textarea class="form-control" th:field="*{razon_estado}" rows="3"
                                        placeholder="Especifica la razón"></textarea>
                                </div>

                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-danger w-25 me-3" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>

                                    <button type="submit" class="btn btn-primary ms-3">GUARDAR ESTADO EDITADO DE LA
                                        HABITACION</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Caso: NO DISPONIBLE -->
                    <div th:case="'NO DISPONIBLE'">
                        <div class="alert alert-dark">
                            <h4 class="fs-2 text-uppercase text-center mb-3">Habitación no disponible</h4>

                            <form th:action="@{/editar-estado/habitacion/{id}(id=${habitacion.id_habitacion})}"
                                th:object="${habitacion}" method="post" class="w-50 mx-auto">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Estado de la Habitación:</label>
                                    <select class="form-select" th:field="*{estado}" th>
                                        <option class="text-center" th:each="estado : ${habEstados}"
                                            th:if="${estado.estado != 'OCUPADO' && estado.estado != 'RESERVADA'}"
                                            th:value="${estado.id_habitacion_estado}" th:text="${estado.estado}">ESTADO
                                        </option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label fw-bold">Razón:</label>
                                    <textarea class="form-control" th:field="*{razon_estado}" rows="3"
                                        placeholder="Especifica la razón"></textarea>
                                </div>

                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-danger w-25 me-3" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>

                                    <button type="submit" class="btn btn-primary ms-3">GUARDAR ESTADO EDITADO DE LA
                                        HABITACION</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Caso: LIMPIEZA -->
                    <div th:case="'LIMPIEZA'">
                        <div class="alert alert-info text-center">
                            <h4 class="fs-2 text-uppercase">Habitación en Limpieza</h4>
                            <p class="fs-4 mt-4">Una vez terminada la limpieza, presiona el botón azul "LIMPIEZA
                                TERMINADA"</p>

                            <form th:action="@{/actualizar-estado-habitacion}" method="post">
                                <input type="hidden" name="id" th:value="${habitacion.id_habitacion}">
                                <input type="hidden" name="nuevoEstado" value="DISPONIBLE">
                                <input type="hidden" name="msgEstado" value="">

                                <div class="col text-center mt-5 mb-3">
                                    <button type="submit" class="btn btn-primary w-25 me-3"
                                        id="btnLimpiezaTerminada">LIMPIEZA
                                        TERMINADA</button>
                                    <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Caso: OCUPADO -->
                    <div th:case="'OCUPADO'">
                        <div class="alert alert-info text-center" id="mantenimientoDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación ocupada</h4>
                            <p class="fs-4 mt-4">Esta habitación ha sido alquilada. <br>
                                Presiona en el botón azul "VER DETALLES" para editar el alquiler actual de la
                                habitacion.
                            </p>

                            <div class="col text-center mt-5 mb-3">
                                <button type="button" class="btn btn-primary w-25 me-3" id="btnVerDetallesOcupado">VER
                                    DETALLES</button>
                                <button type="button" class="btn btn-danger w-25 ms-3" data-bs-toggle="modal"
                                    data-bs-target="#cancelModal">VOLVER</button>
                            </div>
                        </div>
                    </div>

                    <!-- Caso: RESERVA -->
                    <div th:case="'RESERVADA'">
                        <div class="alert alert-success text-center" id="reservadaDivPrevio">
                            <h4 class="fs-2 text-uppercase">Habitación Reservada</h4>
                            <p class="fs-4 mt-5">
                                Presiona en el botón azul "VER DETALLES" para editar la Reserva. <br>
                                Presiona en el botón verde "OCUPAR HABITACIÓN" para finalizar la reserva y generar la
                                venta.
                            </p>

                            <form th:action="@{/actualizar-estado-habitacion}" method="post">
                                <input type="hidden" name="id" th:value="${habitacion.id_habitacion}">
                                <input type="hidden" name="nuevoEstado" value="OCUPADO">
                                <input type="hidden" name="msgEstado" value="">
                                <input type="hidden" name="id_ventaHabitacion" th:value="${ventaParaReserva.id_venta}">

                                <div class="col text-center mt-5 mb-3">
                                    <button type="button" class="btn btn-primary w-25" id="btnVerDetallesReserva">VER
                                        DETALLES
                                    </button>
                                    <button type="submit" class="btn btn-success w-25 mx-3"
                                        id="reservabtnHabilitarReserva">OCUPAR HABITACIÓN</button>
                                    <button type="button" class="btn btn-danger w-25" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Caso por defecto: Formulario para agregar un nuevo estado -->
                    <div th:case="*">
                        <div class="alert shadow w-50 mx-auto">
                            <h4 class="fs-2 text-uppercase text-center mb-3">Habitación disponible</h4>

                            <form th:action="@{/editar-estado/habitacion/{id}(id=${habitacion.id_habitacion})}"
                                th:object="${habitacion}" method="post" class="mx-auto">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Estado de la Habitación:</label>
                                    <select class="form-select" th:field="*{estado}" th>
                                        <option class="text-center" th:each="estado : ${habEstados}"
                                            th:if="${estado.estado != 'OCUPADO' && estado.estado != 'RESERVADA'}"
                                            th:value="${estado.id_habitacion_estado}" th:text="${estado.estado}">ESTADO
                                        </option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label fw-bold">Razón:</label>
                                    <textarea class="form-control" th:field="*{razon_estado}" rows="3"
                                        placeholder="Especifica la razón"></textarea>
                                </div>

                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-danger w-25 me-3" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal">VOLVER</button>

                                    <button type="submit" class="btn btn-primary ms-3">GUARDAR ESTADO EDITADO DE LA
                                        HABITACION</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Sección de Detalles -->
                <div class="tab-pane fade" id="detalles-tab">
                    <h4 class="text-center fw-bold mt-3">Detalles de la Habitación</h4>

                    <div class="table-responsive">
                        <table class="table table-hover shadow-sm border">
                            <thead class="table-dark">
                                <tr>
                                    <th>Característica</th>
                                    <th>Descripción</th>
                                    <th class="text-center">Precio</th>
                                    <th class="text-center">Estado</th>
                                    <th class="text-center">Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="contenido : ${habitacion.habitacionesContenido}">
                                    <td class="align-middle">
                                        <span th:text="${contenido.caracteristica.nombre}"></span>
                                    </td>
                                    <td class="align-middle">
                                        <span th:text="${contenido.caracteristica.descripcion}"></span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span th:text="'S/. ' + ${contenido.caracteristica.precio}"></span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <select class="form-select text-center estado-selector"
                                            th:id="'estado_' + ${contenido.id_habitacion_contenido}"
                                            th:data-id="${contenido.id_habitacion_contenido}">
                                            <option class="text-uppercase" value="DISPONIBLE"
                                                th:selected="${contenido.estado_caracteristica == 'DISPONIBLE'}">
                                                DISPONIBLE</option>
                                            <option class="text-uppercase" value="EN MANTENIMIENTO"
                                                th:selected="${contenido.estado_caracteristica == 'EN MANTENIMIENTO'}">
                                                EN MANTENIMIENTO</option>
                                            <option class="text-uppercase" value="MALOGRADO"
                                                th:selected="${contenido.estado_caracteristica == 'MALOGRADO'}">
                                                MALOGRADO</option>
                                        </select>
                                    </td>
                                    <td class="align-middle text-center">
                                        <button class="btn btn-success guardar-btn"
                                            th:id="'guardar_' + ${contenido.id_habitacion_contenido}"
                                            disabled>GUARDAR</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="text-center">
                            <button type="button" class="btn btn-danger w-25 mt-5 mb-2" data-bs-toggle="modal"
                                data-bs-target="#cancelModal">VOLVER</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- HABITACIONES Y VENTAS -->
    <div class="container-fluid py-3">
        <div class="row">
            <!-- Primera tabla: lado izquierdo -->
            <div class="col-12 col-lg-6 justify-content-center">
                <table class="table table-hover" th:if="${!hab_antiguas.isEmpty()}">
                    <thead class="table-secondary border-light">
                        <tr>
                            <th class="text-center">N°</th>
                            <th class="text-center">HORARIO</th>
                            <th>NOMBRES Y APELLIDOS</th>
                            <th class="text-center px-0">EDAD</th>
                            <th class="text-center px-0">D.N.I.</th>
                            <th class="text-center">TOTAL</th>
                            <th class="text-center px-0">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="hab : ${hab_antiguas}"
                            th:classappend="${hab.estado.estado == 'RESERVADA' ? 'table-primary' : hab.estado.estado == 'LIMPIEZA' ? 'table-success' : ultimaVentaPorHabitacion[hab.id_habitacion]?.estado == 'POR COBRAR' ? 'table-danger' : hab.estado.estado == 'MANTENIMIENTO' ? 'table-warning' : hab.estado.estado == 'NO DISPONIBLE' ? 'table-secondary' : ventasVencidas[hab.id_habitacion] != null ? 'table-danger' : mapAlertaSalida[hab.id_habitacion] != null ? 'table-warning' : ''}">

                            <td class="text-center fw-bold border-light bg-secondary-subtle align-middle"
                                th:text="${hab.numero}"
                                th:title="${'(' + hab.tipo.abreviacion_tipo + ') ' + hab.tipo.nombre_tipo}">
                                N°
                            </td>

                            <!-- #################### EVALUANDO FECHA DE ENTRADA A USAR SEGUN CONDICIONES DE VENTA #################### -->
                            <td class="text-start px-0 ps-2">
                                <span th:if="${ultimaVentaPorHabitacionFechaEntrada[hab.id_habitacion] != null}">
                                    <span
                                        th:text="${'E: ' + #temporals.format(ultimaVentaPorHabitacionFechaEntrada[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span><br>
                                    <span
                                        th:text="${'S: ' + #temporals.format(ultimaVentaPorHabitacionFechaSalida[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span>
                                </span>

                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}">
                                    <span class="text-danger"
                                        th:text="${'E: ' + #temporals.format(ventasVencidasFechaEntrada[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span><br>
                                    <span class="text-danger fw-bold"
                                        th:text="${'S: ' + #temporals.format(ventasVencidasFechaSalida[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span>
                                </span>
                            </td>
                            <!-- ############################################################################################## -->

                            <!-- #################### CONDICIONES SOBRE EL ESTADO DE LA VENTA Y HABITACION #################### -->
                            <td>
                                <!-- ######## CONDICIONES DE LAS HABITACIONES ######## -->
                                <span th:if="${hab.estado.estado == 'RESERVADA'}"
                                    class="bg-primary-subtle fw-bold text-primary">
                                    HABITACIÓN RESERVADA <br>
                                </span>

                                <span th:if="${hab.estado.estado == 'LIMPIEZA'}"
                                    class="bg-success-subtle fw-bold text-success">
                                    HABITACIÓN EN LIMPIEZA <br>
                                </span>

                                <span th:if="${hab.estado.estado == 'MANTENIMIENTO'}"
                                    class="bg-warning-subtle fw-bold text-warning">
                                    HABITACIÓN EN MANTENIMIENTO <br>
                                </span>

                                <span th:if="${hab.estado.estado == 'NO DISPONIBLE'}"
                                    class="bg-dark-subtle fw-semibold text-dark">
                                    HABITACIÓN NO DISPONIBLE PARA VENTAS
                                    <br>
                                </span>
                                <!-- ################################################# -->

                                <!-- ################################ CONDICIONES DE LAS VENTAS ################################ -->
                                <span
                                    th:if="${ultimaVentaPorHabitacion[hab.id_habitacion]?.estado == 'POR COBRAR' || ventasVencidas[hab.id_habitacion]?.estado == 'POR COBRAR'}"
                                    class="bg-danger-subtle fw-bold text-danger">
                                    HABITACIÓN NO PAGADA <br>
                                </span>

                                <span
                                    th:if="${ultimaVentaPorHabitacion[hab.id_habitacion]?.tipo_servicio == 'MEDIO' || ventasVencidas[hab.id_habitacion]?.tipo_servicio == 'MEDIO'}"
                                    class="bg-primary-subtle fw-bold text-primary">
                                    MEDIO DÍA - SALIDA 6:00 PM <br>
                                </span>
                                <!-- ########################################################################################### -->

                                <!-- ####################### MOSTRAMOS NOMBRES Y APELLIDOS DE LOS CLIENTES ##################### -->
                                <span th:if="${ultimaVentaPorHabitacion[hab.id_habitacion] != null}">
                                    <span th:if="${mapAlertaSalida[hab.id_habitacion] == 1}"
                                        class="fw-bold text-light bg-warning px-3">
                                        QUEDA MENOS DE UNA HORA <br>
                                    </span>
                                    <span th:if="${mapAlertaSalida[hab.id_habitacion] == 30}"
                                        class="fw-bold text-light bg-warning px-3">
                                        QUEDA MENOS DE 30 MINUTOS <br>
                                    </span>
                                    <span
                                        th:each="cliente : ${ultimaVentaPorHabitacion[hab.id_habitacion]?.ventasClientesHabitacion}">
                                        <span
                                            th:text="${cliente.usuario_alojado.nombres + ', ' + cliente.usuario_alojado.apellidos}">
                                            NOMBRES Y APELLIDOS
                                        </span>
                                    </span>
                                    <br />
                                </span>


                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    class="fw-bold text-light bg-danger px-3">
                                    TIEMPO EXCEDIDO, AVISAR A LOS CLIENTES
                                    <br>
                                </span>
                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ventasVencidas[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span class="text-danger fw-semibold"
                                        th:text="${cliente.usuario_alojado.nombres + ', ' + cliente.usuario_alojado.apellidos}">
                                        NOMBRES Y APELLIDOS
                                    </span>
                                    <br />
                                </span>
                                <!-- ########################################################################################### -->
                            </td>
                            <!-- ###################################################################################################### -->

                            <!-- ################################## MOSTRAMOS LA EDAD DE LOS CLIENTES #################################### -->
                            <td class="text-center">
                                <span th:if="${ultimaVentaPorHabitacion[hab.id_habitacion].tipo_venta != 'RESERVA'}"
                                    th:each="cliente : ${ultimaVentaPorHabitacion[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span th:text="${cliente.usuario_alojado.edad}"></span><br />
                                </span>

                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ventasVencidas[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span class="text-danger fw-bold" th:text="${cliente.usuario_alojado.edad}">
                                    </span> <br />
                                </span>
                            </td>
                            <!-- ######################################################################################################### -->

                            <!-- ################################## MOSTRAMOS EL D.N.I. DE LOS CLIENTES ################################## -->
                            <td class="text-center">
                                <span th:if="${ultimaVentaPorHabitacion[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ultimaVentaPorHabitacion[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span th:text="${cliente.usuario_alojado.dni}"></span><br />
                                </span>

                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ventasVencidas[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span class="text-danger fw-bold" th:text="${cliente.usuario_alojado.dni}">
                                    </span> <br />
                                </span>
                            </td>
                            <!-- ######################################################################################################### -->

                            <!-- ####################################### PRECIO TOTAL DE LA VENTA ######################################## -->
                            <td class="text-center">
                                <span
                                    th:text="${(ultimaVentaPorHabitacionFechaEntrada[hab.id_habitacion] != null)? 'S/. ' + #numbers.formatDecimal(ultimaVentaPorHabitacion[hab.id_habitacion]?.monto_total, 1, 2) : (ventasVencidas[hab.id_habitacion] != null)? 'S/. ' + #numbers.formatDecimal(ventasVencidas[hab.id_habitacion]?.monto_total, 1, 2) : ''}"
                                    th:classappend="${ventasVencidas[hab.id_habitacion] != null ? 'text-danger fw-bold' : ''}">
                                </span>
                            </td>
                            <!-- ######################################################################################################### -->

                            <td class="text-center align-middle">
                                <form th:action="@{/editar/{id}(id=${hab.id_habitacion})}">
                                    <input th:if="${ultimaVentaPorHabitacion[hab.id_habitacion] != null}" type="hidden"
                                        name="idVenta"
                                        th:value="${ultimaVentaPorHabitacion[hab.id_habitacion]?.id_venta}">

                                    <input th:if="${ventasVencidas[hab.id_habitacion] != null}" type="hidden"
                                        name="idVenta" th:value="${ventasVencidas[hab.id_habitacion]?.id_venta}">

                                    <button type="submit" class="btn btn-sm btn-primary"
                                        th:with="ventaID=${ultimaVentaPorHabitacion[hab.id_habitacion] != null ? ultimaVentaPorHabitacion[hab.id_habitacion].id_venta : 
                                            ventasVencidas[hab.id_habitacion] != null ? ventasVencidas[hab.id_habitacion].id_venta : ''}"
                                        th:title="'Venta: ' + ${ventaID}">
                                        Editar
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Segunda tabla: lado derecho -->
            <div class="col-12 col-lg-6 justify-content-center">
                <table class="table table-hover" th:if="${!hab_modernas.isEmpty()}">
                    <thead class="table-primary border-light">
                        <tr>
                            <th class="text-center">N°</th>
                            <th class="text-center">HORARIO</th>
                            <th>NOMBRES Y APELLIDOS</th>
                            <th class="text-center px-0">EDAD</th>
                            <th class="text-center px-0">D.N.I.</th>
                            <th class="text-center">TOTAL</th>
                            <th class="text-center px-0">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="hab : ${hab_modernas}"
                            th:classappend="${hab.estado.estado == 'RESERVADA' ? 'table-primary' : hab.estado.estado == 'LIMPIEZA' ? 'table-success' : ultimaVentaPorHabitacion[hab.id_habitacion]?.estado == 'POR COBRAR' ? 'table-danger' : hab.estado.estado == 'MANTENIMIENTO' ? 'table-warning' : hab.estado.estado == 'NO DISPONIBLE' ? 'table-secondary' : ventasVencidas[hab.id_habitacion] != null ? 'table-danger' : mapAlertaSalida[hab.id_habitacion] != null ? 'table-warning' : ''}">

                            <td class="text-center fw-bold border-light bg-primary-subtle align-middle"
                                th:text="${hab.numero}"
                                th:title="${'(' + hab.tipo.abreviacion_tipo + ') ' + hab.tipo.nombre_tipo}">
                                N°
                            </td>

                            <!-- #################### EVALUANDO FECHA DE ENTRADA A USAR SEGUN CONDICIONES DE VENTA #################### -->
                            <td class="text-start px-0 ps-2">
                                <span th:if="${ultimaVentaPorHabitacionFechaEntrada[hab.id_habitacion] != null}">
                                    <span
                                        th:text="${'E: ' + #temporals.format(ultimaVentaPorHabitacionFechaEntrada[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span><br>
                                    <span
                                        th:text="${'S: ' + #temporals.format(ultimaVentaPorHabitacionFechaSalida[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span>
                                </span>

                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}">
                                    <span class="text-danger"
                                        th:text="${'E: ' + #temporals.format(ventasVencidasFechaEntrada[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span><br>
                                    <span class="text-danger fw-bold"
                                        th:text="${'S: ' + #temporals.format(ventasVencidasFechaSalida[hab.id_habitacion], 'dd'', ''hh:mm a')}">
                                    </span>
                                </span>
                            </td>
                            <!-- ############################################################################################## -->

                            <!-- #################### CONDICIONES SOBRE EL ESTADO DE LA VENTA Y HABITACION #################### -->
                            <td>
                                <!-- ######## CONDICIONES DE LAS HABITACIONES ######## -->
                                <span th:if="${hab.estado.estado == 'RESERVADA'}"
                                    class="bg-primary-subtle fw-bold text-primary">
                                    HABITACIÓN RESERVADA <br>
                                </span>

                                <span th:if="${hab.estado.estado == 'LIMPIEZA'}"
                                    class="bg-success-subtle fw-bold text-success">
                                    HABITACIÓN EN LIMPIEZA <br>
                                </span>

                                <span th:if="${hab.estado.estado == 'MANTENIMIENTO'}"
                                    class="bg-warning-subtle fw-bold text-warning">
                                    HABITACIÓN EN MANTENIMIENTO <br>
                                </span>

                                <span th:if="${hab.estado.estado == 'NO DISPONIBLE'}"
                                    class="bg-dark-subtle fw-semibold text-dark">
                                    HABITACIÓN NO DISPONIBLE PARA VENTAS
                                    <br>
                                </span>
                                <!-- ################################################# -->

                                <!-- ################################ CONDICIONES DE LAS VENTAS ################################ -->
                                <span
                                    th:if="${ultimaVentaPorHabitacion[hab.id_habitacion]?.estado == 'POR COBRAR' || ventasVencidas[hab.id_habitacion]?.estado == 'POR COBRAR'}"
                                    class="bg-danger-subtle fw-bold text-danger">
                                    HABITACIÓN NO PAGADA <br>
                                </span>

                                <span
                                    th:if="${ultimaVentaPorHabitacion[hab.id_habitacion]?.tipo_servicio == 'MEDIO' || ventasVencidas[hab.id_habitacion]?.tipo_servicio == 'MEDIO'}"
                                    class="bg-primary-subtle fw-bold text-primary">
                                    MEDIO DÍA - SALIDA 6:00 PM <br>
                                </span>
                                <!-- ########################################################################################### -->

                                <!-- ####################### MOSTRAMOS NOMBRES Y APELLIDOS DE LOS CLIENTES ##################### -->
                                <span th:if="${ultimaVentaPorHabitacion[hab.id_habitacion] != null}">
                                    <span th:if="${mapAlertaSalida[hab.id_habitacion] == 1}"
                                        class="fw-bold text-light bg-warning px-3">
                                        QUEDA MENOS DE UNA HORA <br>
                                    </span>
                                    <span th:if="${mapAlertaSalida[hab.id_habitacion] == 30}"
                                        class="fw-bold text-light bg-warning px-3">
                                        QUEDA MENOS DE 30 MINUTOS <br>
                                    </span>
                                    <span
                                        th:each="cliente : ${ultimaVentaPorHabitacion[hab.id_habitacion]?.ventasClientesHabitacion}">
                                        <span
                                            th:text="${cliente.usuario_alojado.nombres + ', ' + cliente.usuario_alojado.apellidos}">
                                            NOMBRES Y APELLIDOS
                                        </span>
                                    </span>
                                    <br />
                                </span>


                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    class="fw-bold text-light bg-danger px-3">
                                    TIEMPO EXCEDIDO, AVISAR A LOS CLIENTES
                                    <br>
                                </span>
                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ventasVencidas[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span class="text-danger fw-semibold"
                                        th:text="${cliente.usuario_alojado.nombres + ', ' + cliente.usuario_alojado.apellidos}">
                                        NOMBRES Y APELLIDOS
                                    </span>
                                    <br />
                                </span>
                                <!-- ########################################################################################### -->
                            </td>
                            <!-- ###################################################################################################### -->

                            <!-- ################################## MOSTRAMOS LA EDAD DE LOS CLIENTES #################################### -->
                            <td class="text-center">
                                <span th:if="${ultimaVentaPorHabitacion[hab.id_habitacion].tipo_venta != 'RESERVA'}"
                                    th:each="cliente : ${ultimaVentaPorHabitacion[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span th:text="${cliente.usuario_alojado.edad}"></span><br />
                                </span>

                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ventasVencidas[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span class="text-danger fw-bold" th:text="${cliente.usuario_alojado.edad}">
                                    </span> <br />
                                </span>
                            </td>
                            <!-- ######################################################################################################### -->

                            <!-- ################################## MOSTRAMOS EL D.N.I. DE LOS CLIENTES ################################## -->
                            <td class="text-center">
                                <span th:if="${ultimaVentaPorHabitacion[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ultimaVentaPorHabitacion[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span th:text="${cliente.usuario_alojado.dni}"></span><br />
                                </span>

                                <span th:if="${ventasVencidas[hab.id_habitacion] != null}"
                                    th:each="cliente : ${ventasVencidas[hab.id_habitacion]?.ventasClientesHabitacion}">
                                    <span class="text-danger fw-bold" th:text="${cliente.usuario_alojado.dni}">
                                    </span> <br />
                                </span>
                            </td>
                            <!-- ######################################################################################################### -->

                            <!-- ####################################### PRECIO TOTAL DE LA VENTA ######################################## -->
                            <td class="text-center">
                                <span
                                    th:text="${(ultimaVentaPorHabitacionFechaEntrada[hab.id_habitacion] != null)? 'S/. ' + #numbers.formatDecimal(ultimaVentaPorHabitacion[hab.id_habitacion]?.monto_total, 1, 2) : (ventasVencidas[hab.id_habitacion] != null)? 'S/. ' + #numbers.formatDecimal(ventasVencidas[hab.id_habitacion]?.monto_total, 1, 2) : ''}"
                                    th:classappend="${ventasVencidas[hab.id_habitacion] != null ? 'text-danger fw-bold' : ''}">
                                </span>
                            </td>
                            <!-- ######################################################################################################### -->

                            <td class="text-center align-middle">
                                <form th:action="@{/editar/{id}(id=${hab.id_habitacion})}">
                                    <input th:if="${ultimaVentaPorHabitacion[hab.id_habitacion] != null}" type="hidden"
                                        name="idVenta"
                                        th:value="${ultimaVentaPorHabitacion[hab.id_habitacion]?.id_venta}">

                                    <input th:if="${ventasVencidas[hab.id_habitacion] != null}" type="hidden"
                                        name="idVenta" th:value="${ventasVencidas[hab.id_habitacion]?.id_venta}">

                                    <button type="submit" class="btn btn-sm btn-primary"
                                        th:with="ventaID=${ultimaVentaPorHabitacion[hab.id_habitacion] != null ? ultimaVentaPorHabitacion[hab.id_habitacion].id_venta : 
                                            ventasVencidas[hab.id_habitacion] != null ? ventasVencidas[hab.id_habitacion].id_venta : ''}"
                                        th:title="'Venta: ' + ${ventaID}">
                                        Editar
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div th:insert="~{fragments/modal :: modal('/')}"></div>

    <script th:src="@{/js/index-editar.js}"></script>
    <script th:src="@{/js/index.js}"></script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>

</html>